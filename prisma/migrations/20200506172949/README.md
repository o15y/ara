# Migration `20200506172949`

This migration has been generated by Anand Chowdhary at 5/6/2020, 5:29:49 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `ara_v2`.`users` (
`checkLocationOnLogin` boolean NOT NULL DEFAULT false ,`countryCode` varchar(191) NOT NULL DEFAULT 'us' ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`gender` ENUM('MALE', 'FEMALE', 'NONBINARY', 'UNKNOWN') NOT NULL DEFAULT 'UNKNOWN' ,`googleAccessToken` varchar(191)   ,`googleRefreshToken` varchar(191)   ,`id` int NOT NULL  AUTO_INCREMENT,`name` varchar(191) NOT NULL  ,`nickname` varchar(191) NOT NULL  ,`notificationEmails` ENUM('ACCOUNT', 'UPDATES', 'PROMOTIONS') NOT NULL DEFAULT 'ACCOUNT' ,`password` varchar(191)   ,`prefersColorScheme` ENUM('NO_PREFERENCE', 'LIGHT', 'DARK') NOT NULL DEFAULT 'NO_PREFERENCE' ,`prefersLanguage` varchar(191) NOT NULL DEFAULT 'en-us' ,`prefersReducedMotion` ENUM('NO_PREFERENCE', 'REDUCE') NOT NULL DEFAULT 'NO_PREFERENCE' ,`primaryEmail` int   ,`profilePicture` varchar(191) NOT NULL DEFAULT 'https://unavatar.now.sh/fallback.png' ,`role` ENUM('SUDO', 'USER') NOT NULL DEFAULT 'USER' ,`timezone` varchar(191) NOT NULL DEFAULT 'America/Los_Angeles' ,`twoFactorEnabled` boolean NOT NULL DEFAULT false ,`twoFactorSecret` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,`username` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`organizations` (
`assistantName` varchar(191) NOT NULL DEFAULT 'Ara Isaacson (AI)' ,`assistantSignature` varchar(191) NOT NULL DEFAULT 'Best,\n\n{{assistant_name}}' ,`autoJoinDomain` boolean NOT NULL DEFAULT false ,`calendars` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`customEmailAddress` varchar(191)   ,`customEmailEnabled` boolean NOT NULL DEFAULT false ,`customEmailHost` varchar(191)   ,`customEmailPassword` varchar(191)   ,`customEmailPort` int   ,`customEmailSecure` boolean NOT NULL DEFAULT false ,`customEmailUsername` varchar(191)   ,`forceTwoFactor` boolean NOT NULL DEFAULT false ,`id` int NOT NULL  AUTO_INCREMENT,`ipRestrictions` varchar(191)   ,`name` varchar(191) NOT NULL  ,`onlyAllowDomain` boolean NOT NULL DEFAULT false ,`profilePicture` varchar(191) NOT NULL DEFAULT 'https://unavatar.now.sh/fallback.png' ,`schedulingDays` varchar(191) NOT NULL DEFAULT '1,2,3,4,5' ,`schedulingPadding` int NOT NULL DEFAULT 30 ,`schedulingTimeEnd` varchar(191) NOT NULL DEFAULT '05:00:00' ,`schedulingTimeStart` varchar(191) NOT NULL DEFAULT '09:00:00' ,`stripeCustomerId` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,`username` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`emails` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`email` varchar(191) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`isVerified` boolean NOT NULL DEFAULT false ,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`access-tokens` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`description` varchar(191)   ,`expiresAt` datetime(3) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`jwtAccessToken` varchar(191) NOT NULL  ,`name` varchar(191)   ,`scopes` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`api-keys` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`description` varchar(191)   ,`expiresAt` datetime(3) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`ipRestrictions` varchar(191)   ,`jwtApiKey` varchar(191) NOT NULL  ,`name` varchar(191)   ,`organizationId` int NOT NULL ,`referrerRestrictions` varchar(191)   ,`scopes` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`approved-locations` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`subnet` varchar(191) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`backup-codes` (
`code` varchar(191) NOT NULL  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`isUsed` boolean NOT NULL DEFAULT false ,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`coupon-codes` (
`amount` int NOT NULL  ,`code` varchar(191) NOT NULL  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`currency` varchar(191) NOT NULL  ,`description` varchar(191)   ,`expiresAt` datetime(3)   ,`id` int NOT NULL  AUTO_INCREMENT,`maxUses` int NOT NULL DEFAULT 1000 ,`teamRestrictions` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,`usedCount` int NOT NULL DEFAULT 0 ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`domains` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`domain` varchar(191) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`isVerified` boolean NOT NULL DEFAULT false ,`organizationId` int NOT NULL ,`updatedAt` datetime(3) NOT NULL  ,`verificationCode` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`identities` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`identityId` varchar(191) NOT NULL  ,`loginName` varchar(191) NOT NULL  ,`type` varchar(191) NOT NULL  ,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`memberships` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`organizationId` int NOT NULL ,`role` ENUM('OWNER', 'ADMIN', 'RESELLER', 'MEMBER') NOT NULL DEFAULT 'MEMBER' ,`updatedAt` datetime(3) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`sessions` (
`city` varchar(191)   ,`countryCode` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`ipAddress` varchar(191) NOT NULL  ,`jwtToken` varchar(191) NOT NULL  ,`region` varchar(191)   ,`timezone` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,`userAgent` varchar(191) NOT NULL  ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ara_v2`.`webhooks` (
`contentType` varchar(191) NOT NULL DEFAULT 'application/json' ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`event` varchar(191) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`isActive` boolean NOT NULL DEFAULT false ,`lastFiredAt` datetime(3)   ,`organizationId` int NOT NULL ,`secret` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,`url` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `users.username` ON `ara_v2`.`users`(`username`)

CREATE UNIQUE INDEX `organizations.username` ON `ara_v2`.`organizations`(`username`)

CREATE  INDEX `userId` ON `ara_v2`.`emails`(`userId`)

CREATE  INDEX `userId` ON `ara_v2`.`access-tokens`(`userId`)

CREATE  INDEX `userId` ON `ara_v2`.`backup-codes`(`userId`)

CREATE  INDEX `organizationId` ON `ara_v2`.`domains`(`organizationId`)

CREATE  INDEX `userId` ON `ara_v2`.`identities`(`userId`)

CREATE  INDEX `organizationId` ON `ara_v2`.`memberships`(`organizationId`)

CREATE  INDEX `userId` ON `ara_v2`.`memberships`(`userId`)

CREATE  INDEX `userId` ON `ara_v2`.`sessions`(`userId`)

CREATE  INDEX `organizationId` ON `ara_v2`.`webhooks`(`organizationId`)

ALTER TABLE `ara_v2`.`emails` ADD FOREIGN KEY (`userId`) REFERENCES `ara_v2`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`access-tokens` ADD FOREIGN KEY (`userId`) REFERENCES `ara_v2`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`api-keys` ADD FOREIGN KEY (`organizationId`) REFERENCES `ara_v2`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`approved-locations` ADD FOREIGN KEY (`userId`) REFERENCES `ara_v2`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`backup-codes` ADD FOREIGN KEY (`userId`) REFERENCES `ara_v2`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`domains` ADD FOREIGN KEY (`organizationId`) REFERENCES `ara_v2`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`identities` ADD FOREIGN KEY (`userId`) REFERENCES `ara_v2`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`memberships` ADD FOREIGN KEY (`organizationId`) REFERENCES `ara_v2`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`memberships` ADD FOREIGN KEY (`userId`) REFERENCES `ara_v2`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`sessions` ADD FOREIGN KEY (`userId`) REFERENCES `ara_v2`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ara_v2`.`webhooks` ADD FOREIGN KEY (`organizationId`) REFERENCES `ara_v2`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200506172949
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,265 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource mysql {
+  provider = "mysql"
+  url      = env("DATABASE_URL")
+}
+
+enum Gender {
+  MALE
+  FEMALE
+  NONBINARY
+  UNKNOWN
+}
+
+enum NotificationEmails {
+  ACCOUNT
+  UPDATES
+  PROMOTIONS
+}
+
+enum PrefersColorScheme {
+  NO_PREFERENCE
+  LIGHT
+  DARK
+}
+
+enum PrefersReducedMotion {
+  NO_PREFERENCE
+  REDUCE
+}
+
+enum UserRole {
+  SUDO
+  USER
+}
+
+enum MembershipRole {
+  OWNER
+  ADMIN
+  RESELLER
+  MEMBER
+}
+
+model users {
+  checkLocationOnLogin Boolean              @default(false)
+  countryCode          String               @default("us")
+  createdAt            DateTime             @default(now())
+  gender               Gender               @default(UNKNOWN)
+  id                   Int                  @default(autoincrement()) @id
+  name                 String
+  nickname             String
+  notificationEmails   NotificationEmails   @default(ACCOUNT)
+  password             String?
+  prefersLanguage      String               @default("en-us")
+  prefersColorScheme   PrefersColorScheme   @default(NO_PREFERENCE)
+  prefersReducedMotion PrefersReducedMotion @default(NO_PREFERENCE)
+  primaryEmail         Int?
+  profilePicture       String               @default("https://unavatar.now.sh/fallback.png")
+  role                 UserRole             @default(USER)
+  timezone             String               @default("America/Los_Angeles")
+  twoFactorEnabled     Boolean              @default(false)
+  twoFactorSecret      String?
+  updatedAt            DateTime             @updatedAt
+  username             String               @unique
+  googleAccessToken    String?
+  googleRefreshToken   String?
+  emails               emails[]             @relation("userEmails")
+  access_tokens        access_tokens[]      @relation("userAccessTokens")
+  approved_locations   approved_locations[] @relation("userApprovedLocations")
+  backup_codes         backup_codes[]       @relation("userBackupCodes")
+  identities           identities[]         @relation("userIdentities")
+  memberships          memberships[]        @relation("userMemberships")
+  sessions             sessions[]           @relation("userSessions")
+}
+
+model organizations {
+  autoJoinDomain      Boolean       @default(false)
+  createdAt           DateTime      @default(now())
+  forceTwoFactor      Boolean       @default(false)
+  id                  Int           @default(autoincrement()) @id
+  ipRestrictions      String?
+  name                String
+  onlyAllowDomain     Boolean       @default(false)
+  profilePicture      String        @default("https://unavatar.now.sh/fallback.png")
+  stripeCustomerId    String?
+  updatedAt           DateTime      @updatedAt
+  username            String        @unique
+  api_keys            api_keys[]    @relation("organizationApiKeys")
+  domains             domains[]     @relation("organizationDomains")
+  memberships         memberships[] @relation("organizationMemberships")
+  webhooks            webhooks[]    @relation("organizationWebhooks")
+  assistantName       String        @default("Ara Isaacson (AI)")
+  assistantSignature  String        @default("Best,\n\n{{assistant_name}}")
+  schedulingDays      String        @default("1,2,3,4,5")
+  schedulingTimeStart String        @default("09:00:00")
+  schedulingTimeEnd   String        @default("05:00:00")
+  schedulingPadding   Int           @default(30)
+  calendars           String?
+  customEmailEnabled  Boolean       @default(false)
+  customEmailAddress  String?
+  customEmailHost     String?
+  customEmailPort     Int?
+  customEmailSecure   Boolean       @default(false)
+  customEmailUsername String?
+  customEmailPassword String?
+}
+
+model emails {
+  createdAt  DateTime @default(now())
+  email      String
+  id         Int      @default(autoincrement()) @id
+  isVerified Boolean  @default(false)
+  updatedAt  DateTime @updatedAt
+  user       users    @relation("userEmails", fields: [userId], references: [id])
+  userId     Int
+
+  @@index([userId], name: "userId")
+}
+
+model access_tokens {
+  createdAt      DateTime @default(now())
+  description    String?
+  expiresAt      DateTime
+  id             Int      @default(autoincrement()) @id
+  jwtAccessToken String
+  name           String?
+  scopes         String?
+  updatedAt      DateTime @updatedAt
+  user           users    @relation("userAccessTokens", fields: [userId], references: [id])
+  userId         Int
+
+  @@index([userId], name: "userId")
+  @@map("access-tokens")
+}
+
+model api_keys {
+  createdAt            DateTime      @default(now())
+  description          String?
+  expiresAt            DateTime
+  id                   Int           @default(autoincrement()) @id
+  ipRestrictions       String?
+  jwtApiKey            String
+  name                 String?
+  organization         organizations @relation("organizationApiKeys", fields: [organizationId], references: [id])
+  organizationId       Int
+  referrerRestrictions String?
+  scopes               String?
+  updatedAt            DateTime      @updatedAt
+
+  @@map("api-keys")
+}
+
+model approved_locations {
+  createdAt DateTime @default(now())
+  id        Int      @default(autoincrement()) @id
+  subnet    String
+  user      users    @relation("userApprovedLocations", fields: [userId], references: [id])
+  userId    Int
+
+  @@map("approved-locations")
+}
+
+model backup_codes {
+  id        Int      @default(autoincrement()) @id
+  code      String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  isUsed    Boolean  @default(false)
+  user      users    @relation("userBackupCodes", fields: [userId], references: [id])
+  userId    Int
+
+  @@index([userId], name: "userId")
+  @@map("backup-codes")
+}
+
+model coupon_codes {
+  id               Int       @default(autoincrement()) @id
+  code             String
+  createdAt        DateTime  @default(now())
+  updatedAt        DateTime  @updatedAt
+  expiresAt        DateTime?
+  maxUses          Int       @default(1000)
+  usedCount        Int       @default(0)
+  teamRestrictions String?
+  amount           Int
+  currency         String
+  description      String?
+
+  @@map("coupon-codes")
+}
+
+model domains {
+  createdAt        DateTime      @default(now())
+  domain           String
+  id               Int           @default(autoincrement()) @id
+  isVerified       Boolean       @default(false)
+  organization     organizations @relation("organizationDomains", fields: [organizationId], references: [id])
+  organizationId   Int
+  updatedAt        DateTime      @updatedAt
+  verificationCode String
+
+  @@index([organizationId], name: "organizationId")
+}
+
+model identities {
+  createdAt  DateTime @default(now())
+  id         Int      @default(autoincrement()) @id
+  identityId String
+  loginName  String
+  type       String
+  updatedAt  DateTime @updatedAt
+  user       users    @relation("userIdentities", fields: [userId], references: [id])
+  userId     Int
+
+  @@index([userId], name: "userId")
+}
+
+model memberships {
+  createdAt      DateTime       @default(now())
+  id             Int            @default(autoincrement()) @id
+  organization   organizations  @relation("organizationMemberships", fields: [organizationId], references: [id])
+  organizationId Int
+  role           MembershipRole @default(MEMBER)
+  updatedAt      DateTime       @updatedAt
+  user           users          @relation("userMemberships", fields: [userId], references: [id])
+  userId         Int
+
+  @@index([organizationId], name: "organizationId")
+  @@index([userId], name: "userId")
+}
+
+model sessions {
+  createdAt   DateTime @default(now())
+  id          Int      @default(autoincrement()) @id
+  ipAddress   String
+  jwtToken    String
+  updatedAt   DateTime @updatedAt
+  userAgent   String
+  city        String?
+  region      String?
+  timezone    String?
+  countryCode String?
+  user        users    @relation("userSessions", fields: [userId], references: [id])
+  userId      Int
+
+  @@index([userId], name: "userId")
+}
+
+model webhooks {
+  contentType    String        @default("application/json")
+  createdAt      DateTime      @default(now())
+  event          String
+  id             Int           @default(autoincrement()) @id
+  isActive       Boolean       @default(false)
+  lastFiredAt    DateTime?
+  organization   organizations @relation("organizationWebhooks", fields: [organizationId], references: [id])
+  organizationId Int
+  secret         String?
+  updatedAt      DateTime      @updatedAt
+  url            String
+
+  @@index([organizationId], name: "organizationId")
+}
```


